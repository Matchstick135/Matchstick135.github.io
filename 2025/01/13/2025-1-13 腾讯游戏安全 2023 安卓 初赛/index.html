<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>腾讯游戏安全 2023 安卓 初赛 | Ms135's Blog</title><meta name="author" content="Ms135"><meta name="copyright" content="Ms135"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一次Unity逆向。虽然以往在CTF中也有遇到过，但是整体逆向思路与使用手段却截然不同。期间参考了许多师傅的解题思路，但即便如此，因自身能力欠佳，全程还是磕磕绊绊。不过有一说一，还是一次很宝贵的体验，收获颇丰。 题目 解题过程符号还原dump解密libil2cpp.so本身被加密，无法直接扔进 Il2CppDumper解密逻辑位于.init_array的 init_proc()中（严格来讲是在.i">
<meta property="og:type" content="article">
<meta property="og:title" content="腾讯游戏安全 2023 安卓 初赛">
<meta property="og:url" content="https://matchstick135.github.io/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/index.html">
<meta property="og:site_name" content="Ms135&#39;s Blog">
<meta property="og:description" content="一次Unity逆向。虽然以往在CTF中也有遇到过，但是整体逆向思路与使用手段却截然不同。期间参考了许多师傅的解题思路，但即便如此，因自身能力欠佳，全程还是磕磕绊绊。不过有一说一，还是一次很宝贵的体验，收获颇丰。 题目 解题过程符号还原dump解密libil2cpp.so本身被加密，无法直接扔进 Il2CppDumper解密逻辑位于.init_array的 init_proc()中（严格来讲是在.i">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://matchstick135.github.io/img/2025-1-13.jpg">
<meta property="article:published_time" content="2025-01-12T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-04T13:08:19.894Z">
<meta property="article:author" content="Ms135">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://matchstick135.github.io/img/2025-1-13.jpg"><link rel="shortcut icon" href="/img/%E5%A4%B4%E5%83%8F.jpg"><link rel="canonical" href="https://matchstick135.github.io/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":5,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '腾讯游戏安全 2023 安卓 初赛',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/背景.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='null'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/2025-1-13.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Ms135's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">腾讯游戏安全 2023 安卓 初赛</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">腾讯游戏安全 2023 安卓 初赛</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-01-12T16:00:00.000Z" title="发表于 2025-01-13 00:00:00">2025-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%80%86%E5%90%91%E6%97%A5%E8%AE%B0/">逆向日记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.5k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>一次Unity逆向。虽然以往在CTF中也有遇到过，但是整体逆向思路与使用手段却截然不同。<br>期间参考了许多师傅的解题思路，但即便如此，因自身能力欠佳，全程还是磕磕绊绊。<br>不过有一说一，还是一次很宝贵的体验，收获颇丰。</p>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><img src="/img/2025-1-13/21.png"></p>
<h1 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h1><h2 id="符号还原"><a href="#符号还原" class="headerlink" title="符号还原"></a>符号还原</h2><h3 id="dump解密"><a href="#dump解密" class="headerlink" title="dump解密"></a>dump解密</h3><p>libil2cpp.so本身被加密，无法直接扔进 Il2CppDumper<br>解密逻辑位于.init_array的 init_proc()中（严格来讲是在.init_array前执行）<br>且是调用了 libsec2023.so 的g_sec2023_p_array中的解密函数<br><img src="/img/2025-1-13/1.jpg"></p>
<p>这里选择用frida dump出解密后的 libil2cpp.so<br>注意存在frida检测，不过可以通过改端口等方式进行绕过，或者整一个魔改版frida</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dump_so</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> so_name = <span class="string">&quot;libil2cpp.so&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> currentApplication = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">currentApplication</span>();</span><br><span class="line">        <span class="keyword">var</span> dir = currentApplication.<span class="title function_">getApplicationContext</span>().<span class="title function_">getFilesDir</span>().<span class="title function_">getPath</span>();</span><br><span class="line">        <span class="keyword">var</span> libso = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(so_name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> file_path = dir + <span class="string">&quot;/&quot;</span> + libso.<span class="property">name</span> + <span class="string">&quot;_&quot;</span> + libso.<span class="property">base</span> + <span class="string">&quot;_&quot;</span> + <span class="title function_">ptr</span>(libso.<span class="property">size</span>) + <span class="string">&quot;.so&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> file_handle = <span class="keyword">new</span> <span class="title class_">File</span>(file_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (file_handle &amp;&amp; file_handle !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>), libso.<span class="property">size</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> libso_buffer = <span class="title function_">ptr</span>(libso.<span class="property">base</span>).<span class="title function_">readByteArray</span>(libso.<span class="property">size</span>);</span><br><span class="line">            file_handle.<span class="title function_">write</span>(libso_buffer);</span><br><span class="line">            file_handle.<span class="title function_">flush</span>();</span><br><span class="line">            file_handle.<span class="title function_">close</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[dump]:&quot;</span>, file_path);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[dump]: Failed to create file handle for &quot;</span> + file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><p>由于dump出的so是在内存映像下的，在IDA中的静态分析场景中还是会部分爆红，因此还要进行修复<br>这里选择扔进 010 Editor，使用 ELF.bt模板，手动修复</p>
<ol>
<li>segment 文件偏移</li>
</ol>
<p>对于 program_header_table 的每个 element————<br>取 p_vaddr，填到 p_offset<br>取 p_memsz，填到 p_filesz</p>
<ol start="2">
<li>section_header_table 文件偏移</li>
</ol>
<p>对于 program_header_table 的末尾 element————<br>取 p_vaddr + p_memsz，填到 elf_header 的 e_shoff</p>
<ol start="3">
<li>section 内容</li>
</ol>
<p>取原so section_header_table，填到待修复so section_header_table</p>
<ol start="4">
<li>section 名称</li>
</ol>
<p>通过 elf_header 的 e_shtrndx，找到 section_header_table 中.shstrtab的 element<br>对于该 element————<br>取原so 的 s_offset 处的数据，填到待修复so 的 s_offset 处</p>
<ol start="5">
<li>section 文件偏移</li>
</ol>
<p>对于 section_header_table 的每个 element————<br>取不为0的 s_addr，填到 s_offset</p>
<h3 id="恢复符号"><a href="#恢复符号" class="headerlink" title="恢复符号"></a>恢复符号</h3><p>接下来就是与往常一样了，把 global-metadata.dat和修复后的 libil2cpp.so扔进 Il2CppDumper，获取符号信息；<br>然后在IDA中通过ida_with_struct_py3.py脚本，使用 script.json, il2cpp.h 对libil2cpp.so 进行符号还原</p>
<h2 id="获取Flag"><a href="#获取Flag" class="headerlink" title="获取Flag"></a>获取Flag</h2><p>既然题目中说 “收集金币数量超过1000时，赢得Flag”，说明libil2cpp.so中某处一定存在 金币数量比较逻辑<br>这里选择将比较目标”1000”改为”0”，即可实现开局就输出Flag</p>
<p>通过搜索“coin”相关字符串，可以定位到 CollectCoin()，进而定位到比较逻辑<br><img src="/img/2025-1-13/6.png"></p>
<p>接下来通过frida，将此处 “CMP W0, #3E8” 语句改为 “CMP W0, #0”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> libil2cpp = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libil2cpp.so&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> coinCmpAddress = <span class="title function_">ptr</span>(libil2cpp.<span class="property">base</span>).<span class="title function_">add</span>(<span class="number">0x4652E4</span> + (<span class="number">0x7AD79283CC</span> - <span class="number">0x7AD79282E4</span>));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(coinCmpAddress), <span class="number">4</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">writeU32</span>(<span class="title function_">ptr</span>(coinCmpAddress), <span class="number">0x7100001f</span>);  <span class="comment">// CMP W0, #0</span></span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(coinCmpAddress), <span class="number">4</span>, <span class="string">&#x27;rx&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注册机分析"><a href="#注册机分析" class="headerlink" title="注册机分析"></a>注册机分析</h2><h3 id="按键逻辑分析"><a href="#按键逻辑分析" class="headerlink" title="按键逻辑分析"></a>按键逻辑分析</h3><p>dump.cs中可以看到 SmallKeyboard相关函数，猜测对应游戏中 “Mod Menu”界面的按键逻辑<br>libil2cpp.so中来到该函数处，可以看到通过 KeyType变量进入不同类型按键 的响应逻辑分支<br><img src="/img/2025-1-13/5.png"></p>
<p>重点关注 “keyType &#x3D;&#x3D; 2”的情况，其中————</p>
<ol>
<li>System_Convert__ToUInt64_486054767044()将玩家输入存入v13</li>
<li>SmallKeyboard__iI1Ii_486050613936()传入v13，其中调用了外部函数，<br>即 libsec2023.so中位于 g_sec2023_p_array偏移0x48处的函数<br><img src="/img/2025-1-13/7.png"></li>
</ol>
<h3 id="反内存修改检测"><a href="#反内存修改检测" class="headerlink" title="反内存修改检测"></a>反内存修改检测</h3><p>视角转到 libsec2023.so，正准备开始后续分析时，惊奇发现此时附加上frida会被检测到（严格来讲是使用frida进行hook时，几秒后会被检测到）<br>明明前面已对frida特征进行隐藏了，为什么还是如此？<br>其实还存在一种检测frida的角度，就是对 Inline Hook修改内存的行为进行检测（上方frida被检测时的反应，很契合此种检测手段的特点）</p>
<p>在讲对抗方式之前，先大致了解下其检测原理————</p>
<ol>
<li>开启后台线程（pthread_create()），每隔一段时间（sleep()）执行检测逻辑</li>
<li>可以选择对关键函数的开头进行检查，是否存在 Inline Hook的几字节跳转逻辑；<br>或者直接对该内存区域进行CRC校验，查看每次返回的CRC值是否更改</li>
</ol>
<p>既然如此，可以选择hook修改 sleep()传参，将检测逻辑的执行间隔改大；<br>同时打印其堆栈信息，从而定位到调用sleep()的检测逻辑处</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_sleep</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> sleep_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;sleep&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> original_sleep = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(sleep_addr, <span class="string">&#x27;void&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(sleep_addr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            args[<span class="number">0</span>] = <span class="title function_">ptr</span>(<span class="number">1000000</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Modified duration to: &#x27;</span> + args[<span class="number">0</span>].<span class="title function_">toInt32</span>() + <span class="string">&#x27; seconds.&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Sleep call finished.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这里每次对 sub_376CC的返回值进行检查，进而对v9进行更改<br>如果检测到修改则v9为0x38，否则为0x28<br><img src="/img/2025-1-13/9.png"></p>
<p>因此，可以选择spawn模式 patch此处汇编，把 “MOV W9, #0x38” 改为 “MOV W9, #0x28”<br>至此，frida可任意进行hook</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> libso = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libsec2023.so&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (libso) &#123;</span><br><span class="line">            <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>), libso.<span class="property">size</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">            <span class="title class_">Memory</span>.<span class="title function_">writeByteArray</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>).<span class="title function_">add</span>(<span class="number">0x371D0</span>), [<span class="number">0x09</span>, <span class="number">0x05</span>, <span class="number">0x80</span>, <span class="number">0x52</span>]);  <span class="comment">// MOV W9, #0x28</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Successfully patched libsec2023.so at address: &quot;</span> + <span class="title function_">ptr</span>(libso.<span class="property">base</span>).<span class="title function_">add</span>(<span class="number">0x371D0</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Failed to find module &#x27;libsec2023.so&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反混淆"><a href="#反混淆" class="headerlink" title="反混淆"></a>反混淆</h3><p>回归正题，基于g_sec2023_p_array中偏移0x48处，来到libsec2023.so的 sub_31164<br><img src="/img/2025-1-13/8.png"></p>
<p>发现其中存在大量 基于如下形式的混淆————<br>通过CSEL为要参与后续运算的寄存器 进行条件赋值；再通过ADD运算构造出地址；最后BR跳转到目标位置；<br>将原本一个 条件分支下的直接跳转，转换成寄存器寻址下的间接跳转<br><img src="/img/2025-1-13/11.jpg"></p>
<p>这里选择比较原始的方式，即手动patch的方式去混淆————</p>
<ol>
<li>先将各处BR指令改为B.XX指令，把间接跳转还原回直接跳转</li>
<li>跟进到直接跳转处，重复上述步骤，直到遇到RET</li>
<li>然后对此函数所有逻辑进行快捷键u，取消定义</li>
<li>最后再统一快捷键c、p，编译指令后生成函数</li>
</ol>
<p>以下为与加密相关函数的patch位置————</p>
<ol>
<li><p>sub_3B8CC</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>B950 <span class="number">61</span> <span class="number">00</span> <span class="number">00</span> <span class="number">54</span>                   B.NE            loc_3B95C</span><br><span class="line">.text:<span class="number">000000000003</span>B990 <span class="number">61</span> <span class="number">00</span> <span class="number">00</span> <span class="number">54</span>                   B.EQ            loc_3B99C</span><br></pre></td></tr></table></figure>
</li>
<li><p>sub_3B8CC-&gt;sub_3B9D4</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>BA00 <span class="number">8</span>A <span class="number">0</span>A <span class="number">00</span> <span class="number">54</span>                   B.GE            loc_3BB50</span><br><span class="line">.text:<span class="number">000000000003</span>BA30 <span class="number">23</span> <span class="number">02</span> <span class="number">00</span> <span class="number">54</span>                   B.CC            loc_3BA74</span><br><span class="line">.text:<span class="number">000000000003</span>BA70 <span class="number">2</span>A FE FF <span class="number">54</span>                   B.GE            loc_3BA34</span><br><span class="line">.text:<span class="number">000000000003</span>BADC <span class="number">83</span> <span class="number">02</span> <span class="number">00</span> <span class="number">54</span>                   B.CC            loc_3BB2C</span><br><span class="line">.text:<span class="number">000000000003</span>BB28 CA FD FF <span class="number">54</span>                   B.GE            loc_3BAE0</span><br><span class="line">.text:<span class="number">000000000003</span>BB4C C3 F5 FF <span class="number">54</span>                   B.CC            loc_3BA04</span><br></pre></td></tr></table></figure>
</li>
<li><p>sub_3B8CC-&gt;sub_3A054</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>A08C <span class="number">21</span> <span class="number">03</span> <span class="number">00</span> <span class="number">54</span>                   B.NE            loc_3A0F0</span><br><span class="line">.text:<span class="number">000000000003</span>A0C8 <span class="number">41</span> <span class="number">01</span> <span class="number">00</span> <span class="number">54</span>                   B.NE            loc_3A0F0</span><br></pre></td></tr></table></figure>
</li>
<li><p>sub_3B8CC-&gt;sub_3A924</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>AA70 <span class="number">40</span> <span class="number">05</span> <span class="number">00</span> <span class="number">54</span>                   B.EQ            loc_3AB18</span><br><span class="line">.text:<span class="number">000000000003</span>AAA0 C0 <span class="number">03</span> <span class="number">00</span> <span class="number">54</span>                   B.EQ            loc_3AB18</span><br><span class="line">.text:<span class="number">000000000003</span>AAD4 A0 <span class="number">01</span> <span class="number">00</span> <span class="number">54</span>                   B.EQ            loc_3AB08</span><br><span class="line">.text:<span class="number">000000000003</span>AB04 <span class="number">60</span> <span class="number">03</span> <span class="number">00</span> <span class="number">54</span>                   B.EQ            loc_3AB70</span><br></pre></td></tr></table></figure>
</li>
<li><p>sub_3B8CC-&gt;sub_3A924-&gt;sub_3B4B8</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>B508 <span class="number">1</span>F <span class="number">20</span> <span class="number">03</span> D5                   NOP</span><br><span class="line">.text:<span class="number">000000000003</span>B54C <span class="number">0</span>D FE FF <span class="number">54</span>                   B.LE            loc_3B50C</span><br></pre></td></tr></table></figure>
</li>
<li><p>sub_3B8CC-&gt;sub_3A924-&gt;sub_3B570</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000003</span>B5C0 <span class="number">1</span>F <span class="number">20</span> <span class="number">03</span> D5                   NOP</span><br><span class="line">.text:<span class="number">000000000003</span>B604 <span class="number">0</span>D FE FF <span class="number">54</span>                   B.LE            loc_3B5C4</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="加密分析-I"><a href="#加密分析-I" class="headerlink" title="加密分析 I"></a>加密分析 I</h3><p>现在终于可以对 libsec2023.so中的sub_31164进行分析了</p>
<ol>
<li><p>sub_3B8CC<br><img src="/img/2025-1-13/14.png"></p>
</li>
<li><p>sub_3B8CC-&gt;sub_3B9D4<br>加密过程涉及数组操作，需先将 “int v8”类型改为 “char v8[4]”<br><img src="/img/2025-1-13/12.png"></p>
</li>
</ol>
<p>还原后如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">encrypt1</span><span class="params">(<span class="type">uint32_t</span> ipt[])</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">ssize_t</span> idx = <span class="number">0</span>; idx &lt; <span class="number">2</span>; ++idx) &#123;</span><br><span class="line">    <span class="type">uint8_t</span> buf[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;, tmp[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">ssize_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      buf[i] = ((<span class="type">uint8_t</span> *)&amp;ipt[idx])[i] ^ i;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    buf[<span class="number">3</span>] ^= <span class="number">0x86</span>;</span><br><span class="line">    buf[<span class="number">2</span>] -= <span class="number">0x5E</span>;</span><br><span class="line">    buf[<span class="number">1</span>] ^= <span class="number">0xD3</span>;</span><br><span class="line">    buf[<span class="number">0</span>] -= <span class="number">0x1C</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">ssize_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      tmp[i] = buf[i] - i * <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    ipt[idx] = *(<span class="type">uint32_t</span> *)&amp;tmp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>sub_3B8CC-&gt;sub_3A924<br>看到 v11偏移1000+处的函数指针，由此推出涉及JNI操作，需要先将v11的类型改为 “JNIEnv*”<br><img src="/img/2025-1-13/13.png"></li>
</ol>
<p>通过hook输出 GetStaticMethodID()的传参，可获取要调用的java方法 名为”encrypt”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookGetStaticMethodID</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> symbols = <span class="title class_">Module</span>.<span class="title function_">enumerateSymbolsSync</span>(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> symbol <span class="keyword">of</span> symbols) &#123;</span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span>.<span class="title function_">includes</span>(<span class="string">&quot;GetStaticMethodID&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> jniAddress = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(jniAddress, &#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Class name:&#x27;</span>, args[<span class="number">2</span>].<span class="title function_">readCString</span>());</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Method name:&#x27;</span>, args[<span class="number">3</span>].<span class="title function_">readCString</span>());</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Signature:&#x27;</span>, args[<span class="number">4</span>].<span class="title function_">readCString</span>());</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>既然是java方法，那就转向java层分析。然而将应用拖进jadx，发现搜索不到名为”encrypt”的方法<br>因此猜测该encrypt方法所在的dex，是在应用运行期间动态加载进内存的<br>由此使用frida-dexdump，dump出dex<br><img src="/img/2025-1-13/15.png"></p>
<p>接下来从 classes00.dex开始一个个拖进jadx，成功找到 Encrypt.encrypt()<br><img src="/img/2025-1-13/16.png"></p>
<p>代码是经过 BlackObfuscator混淆过的，不过可以通过扔进 自带反混淆功能的JEB<br>优化后的代码大致是这个样子的<br><img src="/img/2025-1-13/17.png"></p>
<p>还原后如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">encrypt2</span><span class="params">(<span class="type">uint32_t</span> ipt)</span> </span>&#123;</span><br><span class="line">  <span class="type">uint32_t</span> n1 = <span class="number">0</span>, n2 = <span class="number">0</span>;</span><br><span class="line">  <span class="type">uint8_t</span> result[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;, *buf = (<span class="type">uint8_t</span> *)&amp;ipt;</span><br><span class="line">  <span class="type">uint8_t</span> key[<span class="number">8</span>] = &#123;<span class="number">0x32</span>, <span class="number">0xCD</span>, <span class="number">0xFF</span>, <span class="number">0x98</span>, <span class="number">0x19</span>, <span class="number">0xB2</span>, <span class="number">0x7C</span>, <span class="number">0x9A</span>&#125;;</span><br><span class="line"> </span><br><span class="line">  n1 = __builtin_bswap32(*(<span class="type">uint32_t</span> *)buf);</span><br><span class="line">  n2 = (n1 &gt;&gt; <span class="number">7</span>) | (n1 &lt;&lt; <span class="number">25</span>);</span><br><span class="line"> </span><br><span class="line">  *(<span class="type">uint32_t</span> *)result = __builtin_bswap32(n2);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> idx = <span class="number">0</span>; idx &lt; <span class="number">8</span>; idx++) &#123;</span><br><span class="line">    result[idx] = (result[idx] ^ key[idx % <span class="number">8</span>]);</span><br><span class="line">    result[idx] = (result[idx] + idx);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">uint32_t</span> *)result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="加密分析-II"><a href="#加密分析-II" class="headerlink" title="加密分析 II"></a>加密分析 II</h3><p>sub_31164中调用完 sub_3B8CC后，来了个间接跳转<br><img src="/img/2025-1-13/18.png"><br>动调跟进发现回到了 libil2cpp.so，开始执行 sub_465AB4<br><img src="/img/2025-1-13/19.png"></p>
<ol>
<li><p>sub_465AB4-&gt;OO0OoOOo_Oo0__oOOoO0o0()<br>循环读取opcode，分发给各个handler，具备VM的特征<br>然而因本人目前能力有限，此处暂无法做分析并还原</p>
</li>
<li><p>sub_465AB4-&gt;魔改XTEA<br>继VM之后，来到最后的XTEA加密，存在魔改<br><img src="/img/2025-1-13/20.png"></p>
</li>
</ol>
<p>其中v24为key，因为是动态生成的，所以可通过动调可获取<br>整体逻辑还原后如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">encrypt4</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> v1, <span class="type">unsigned</span> <span class="type">int</span> v2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key[] = &#123; <span class="number">0x7b777c63</span>, <span class="number">0xc56f6bf2</span>, <span class="number">0x2b670130</span>, <span class="number">0x76abd7fe</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> sum1 = <span class="number">0xBEEFBEEF</span>, sum2 = <span class="number">0x9D9D7DDE</span>, i = <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        v1 += (sum1 - key[(sum1 &amp; <span class="number">3</span>)]) ^ (((v2 &lt;&lt; <span class="number">7</span>) ^ (v2 &gt;&gt; <span class="number">8</span>)) + v2);</span><br><span class="line">        sum1 -= <span class="number">0x21524111</span>;</span><br><span class="line">        v2 += (sum2 + key[(sum2 &gt;&gt; <span class="number">13</span>) &amp; <span class="number">3</span>]) ^ (((v1 &lt;&lt; <span class="number">8</span>) ^ (v1 &gt;&gt; <span class="number">7</span>)) - v1);</span><br><span class="line">        sum2 -= <span class="number">0x21524111</span>;</span><br><span class="line">        --i;</span><br><span class="line">    &#125; <span class="keyword">while</span> (i);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="题目标签"><a href="#题目标签" class="headerlink" title="题目标签"></a>题目标签</h1><pre><code>Unity、so加固（加密）、Frida检测（端口、CRC）、花指令（CSEL+BR）、代码混淆（BlackObfuscator）、动态加载、VM、魔改XTEA | 
so dump、so修复、符号还原、dex dump
</code></pre>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://oacia.dev/sec-2023/">https://oacia.dev/sec-2023/</a><br><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-276949.htm">https://bbs.kanxue.com/thread-276949.htm</a><br><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-276896.htm">https://bbs.kanxue.com/thread-276896.htm</a><br><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-276893.htm">https://bbs.kanxue.com/thread-276893.htm</a><br><a target="_blank" rel="noopener" href="https://moodyblue.cn/category/%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E5%AE%89%E5%8D%932023%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/">https://moodyblue.cn/category/%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E5%AE%89%E5%8D%932023%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Matchstick135.github.io">Ms135</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://matchstick135.github.io/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/">https://matchstick135.github.io/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Matchstick135.github.io" target="_blank">Ms135's Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/2025-1-13.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/08/2025-1-8%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2024 安卓 初赛"><img class="cover" src="/img/2024-9-1.jpg" onerror="onerror=null;src='/null'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">腾讯游戏安全 2024 安卓 初赛</div></div><div class="info-2"><div class="info-item-1">一次UE4逆向的初体验，整体下来的感觉就是，在运用常规Android逆向手段的基础上，还要对UE4的 C++源码、API使用、对象内存布局 都较为熟悉，不然无从下手  题目 环境搭建ARM64模拟器原来一直用的 leidian模拟器是x86-64的，但是这里限制ARM64，所以得搞一台然而人比较懒，比起物理机，还是想着用Android Studio中自带的模拟器 创建后一跑，报错“Unable to launch Pixel 8 APl34-Theemulator process for AVD Pixel_8_APl_34 hasterminated.”按照网上的教程动了环境变量、.android\avd 路径、Windows功能————结果都无济于事这时候意识到Android Studio还有个日志（C:\Users\xxx\AppData\Local\Google\AndroidStudio2023.3\log\idea.log） 难道我x86-64主机注定与ARM64模拟器无缘吗？其实不然，查阅资料得知，x86_64 主机上进行 ARM64 模拟目前只能达到 API...</div></div></div></a><a class="pagination-related" href="/2025/01/14/2025-4-14%20%E4%BA%AC%E4%B8%9Csign%E5%AD%97%E6%AE%B5%E5%88%86%E6%9E%90/" title="京东sign字段分析"><img class="cover" src="/img/2025-4-14.jpg" onerror="onerror=null;src='/null'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">京东sign字段分析</div></div><div class="info-2"><div class="info-item-1">这么说来，自从学会抓包的基本流程后，似乎一直都是在单纯为了抓包而抓包想到这里才如梦初醒，抓包不是一直以来都是逆向中极为重要的一环吗，自己却如此割裂地看待两者，属实是浅薄了于是，为了让自己进行的抓包操作，不再是”单纯为了抓包而抓包”，于是便有了这篇记录 抓包打开Charles，再配置系统代理后 即可开始抓包锁定如下URL，分析其参数可以看到...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/null'" alt="avatar"/></div><div class="author-info-name">Ms135</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">解题过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E8%BF%98%E5%8E%9F"><span class="toc-number">2.1.</span> <span class="toc-text">符号还原</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dump%E8%A7%A3%E5%AF%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">dump解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D"><span class="toc-number">2.1.2.</span> <span class="toc-text">修复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.1.3.</span> <span class="toc-text">恢复符号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Flag"><span class="toc-number">2.2.</span> <span class="toc-text">获取Flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%9C%BA%E5%88%86%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">注册机分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%94%AE%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90"><span class="toc-number">2.3.1.</span> <span class="toc-text">按键逻辑分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%86%85%E5%AD%98%E4%BF%AE%E6%94%B9%E6%A3%80%E6%B5%8B"><span class="toc-number">2.3.2.</span> <span class="toc-text">反内存修改检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B7%B7%E6%B7%86"><span class="toc-number">2.3.3.</span> <span class="toc-text">反混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%88%86%E6%9E%90-I"><span class="toc-number">2.3.4.</span> <span class="toc-text">加密分析 I</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%88%86%E6%9E%90-II"><span class="toc-number">2.3.5.</span> <span class="toc-text">加密分析 II</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%A0%87%E7%AD%BE"><span class="toc-number">3.</span> <span class="toc-text">题目标签</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2023 安卓 初赛"><img src="/img/2025-1-13.jpg" onerror="this.onerror=null;this.src='/null'" alt="腾讯游戏安全 2023 安卓 初赛"></a><div class="content"><a class="title" href="/2025/01/13/2025-1-13%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202023%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2023 安卓 初赛">腾讯游戏安全 2023 安卓 初赛</a><time datetime="2025-01-12T16:00:00.000Z" title="发表于 2025-01-13 00:00:00">2025-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/08/2025-1-8%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2024 安卓 初赛"><img src="/img/2024-9-1.jpg" onerror="this.onerror=null;this.src='/null'" alt="腾讯游戏安全 2024 安卓 初赛"></a><div class="content"><a class="title" href="/2025/01/08/2025-1-8%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20%E5%AE%89%E5%8D%93%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2024 安卓 初赛">腾讯游戏安全 2024 安卓 初赛</a><time datetime="2025-01-07T16:00:00.000Z" title="发表于 2025-01-08 00:00:00">2025-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/09/2024-9-9%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20PC%20%E5%86%B3%E8%B5%9B/" title="腾讯游戏安全 2024 PC 决赛"><img src="/img/2024-9-1.jpg" onerror="this.onerror=null;this.src='/null'" alt="腾讯游戏安全 2024 PC 决赛"></a><div class="content"><a class="title" href="/2024/09/09/2024-9-9%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20PC%20%E5%86%B3%E8%B5%9B/" title="腾讯游戏安全 2024 PC 决赛">腾讯游戏安全 2024 PC 决赛</a><time datetime="2024-09-08T16:00:00.000Z" title="发表于 2024-09-09 00:00:00">2024-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/01/2024-9-1%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20PC%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2024 PC 初赛"><img src="/img/2024-9-1.jpg" onerror="this.onerror=null;this.src='/null'" alt="腾讯游戏安全 2024 PC 初赛"></a><div class="content"><a class="title" href="/2024/09/01/2024-9-1%20%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%202024%20PC%20%E5%88%9D%E8%B5%9B/" title="腾讯游戏安全 2024 PC 初赛">腾讯游戏安全 2024 PC 初赛</a><time datetime="2024-08-31T16:00:00.000Z" title="发表于 2024-09-01 00:00:00">2024-09-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>